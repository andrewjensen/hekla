#!/usr/bin/env node

const fs = require('fs');
const path = require('path');
const analyzer = require('../src/analyzer');

if (process.argv.length !== 4) {
  console.error('Error: you must provide rootPath and output JSON file');
  process.exit(1);
}

const rootPath = process.argv[2];
const jsonFilename = process.argv[3];

analyzer.analyzePath(rootPath)
  .then(results => writeJSON(jsonFilename, results));




// TODO: move function somewhere else
function writeJSON(filename, data) {
  return new Promise((resolve, reject) => {
    const output = JSON.stringify(data, null, 2) + '\n';
    fs.writeFile(filename, output, (err) => {
      if (err) return reject(err);
      resolve();
    });
  });
}
